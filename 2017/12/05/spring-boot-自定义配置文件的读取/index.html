<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> spring boot-自定义配置文件的读取 · qiudx博客</title><meta name="description" content="spring boot-自定义配置文件的读取 - qiudx"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="https://www.qiudx.top/atom.xml" title="qiudx博客"><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="qiudx博客" type="application/atom+xml">
</head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">qiudx博客</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>首页</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>归档</p></a><a href="/about" target="_self" class="li component-nav-item"><p>关于我</p></a><ul class="shortcut-icons"><a href="https://github.com/qiudxx" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="/atom.xml" target="_blank"><img src="/images/rss.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">spring boot-自定义配置文件的读取</h1><div class="post-info">Dec 5, 2017</div><div class="post-content"><p><strong>概要</strong></p>
<ul>
<li>用springboot 自带的类Environment读取配置文件</li>
<li>Configurable方式读取配置文件</li>
<li>@PropertySource注解方式读取配置文件</li>
<li>使用@ConfigurationProperties读取配置文件</li>
</ul>
<a id="more"></a>


<p>在spring boot种自定义配置文件的读取很方便，不用在写propert的读取类来读取配置文件信息。</p>
<p>下面是我试过的读取springboot读取配置文件的几种方法：</p>
<p>准备：</p>
<ol>
<li><p>在application.yml文件种加入配置信息：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hank:</span><br><span class="line">  testConfig: TestDriver</span><br></pre></td></tr></table></figure></li>
<li><p>新建立配置文件 dbConfig.properties</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driver=com.mysql.jdbc.Driver</span><br><span class="line">jdbc.url=jdbc:mysql:<span class="comment">//localhost:3306/test</span></span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=root</span><br><span class="line">org.hank.testconfig = testConfig</span><br></pre></td></tr></table></figure>
<p>测试:</p>
</li>
<li><p>用springboot 自带的类Environment读取配置文件</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Environment env;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testConfigDefault</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    logger.info(<span class="string">"Environment get default properties:"</span> + env.getProperty(<span class="string">"hank.testConfig"</span>));</span><br><span class="line">    logger.info(<span class="string">"Environment get self properties:"</span> + env.getProperty(<span class="string">"jdbc.driver"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 测试结果</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Environment get <span class="keyword">default</span> properties:TestDriver</span><br><span class="line">Environment get self properties:<span class="keyword">null</span></span><br></pre></td></tr></table></figure>
<p> 结论：也就是说Environment自带的只能读取默认的配置文件里面的配置信息，自定义的配置文件在Environment是读取不了的。况且在application.yml配置的都是系统自身的项，也就是不随系统环境改变而改变的配置项。一些易变的配置项我们还是自定义文件的比较好。我一般不会这么配置。</p>
</li>
<li><p>Configurable方式读取配置文件</p>
<p> 建立类ConfigDefault 注解@Configurable</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Configurable</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigDefault</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;hank.testConfig&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String hankConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;org.hank.testconfig&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String selfConfig;</span><br><span class="line"></span><br><span class="line">    getter and setter....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 测试：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ConfigDefault configDefault;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testConfigDefault</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    logger.info(<span class="string">"defualt config--hank.testConfig:"</span> + configDefault.getHankConfig());</span><br><span class="line">    logger.info(<span class="string">"self config--org.hank.testconfig:"</span> + configDefault.getSelfConfig());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 测试结果：直接报错，Could not resolve placeholder ‘org.hank.testconfig’ in value “${org.hank.testconfig}”<br> 也就说application.yml文件中没有org.hank.testconfig这配置项，所以在类上加@Configurable也是默认只读取application.yml文件的配置项</p>
</li>
<li><p>@PropertySource注解方式读取配置文件<br> 新建model类：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@PropertySource</span>(<span class="string">"classpath:dbConfig.properties"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataBaseConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.driver&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.url&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.username&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.password&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;hank.testConfig&#125;"</span>) <span class="comment">//测试默认配置文件</span></span><br><span class="line">    <span class="keyword">private</span> String hankConfig;</span><br><span class="line"></span><br><span class="line">    getter and setter...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 测试：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> DataBaseConfig config;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetDataBaseConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    logger.info(<span class="string">"self Config Driver:"</span> + config.getDriver());</span><br><span class="line">    logger.info(<span class="string">"default config hank.testConfig:"</span> + config.getHankConfig());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 测试结果：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">self Config Driver:com.mysql.jdbc.Driver</span><br><span class="line"><span class="keyword">default</span> config hank.testConfig:TestDriver</span><br></pre></td></tr></table></figure>
<p> 可以看出连同默认配置的信息也读取到了</p>
<p> 结论：用@PropertySource(“classpath:dbConfig.properties”)<br> 指定自定义配置文件路径就可以读取到自定义的配置文件信息，而对于默认配置文件application.yml我们也能在读取自定义配置文件的同时读取到默认配置文件的信息。<br> 以上就是三中读取配置文件的方式，可以看到要想读取自定义的配置文件，就必须要注解指定配置文件路径。</p>
</li>
<li><p>使用@ConfigurationProperties读取配置文件<br> 特別注意：</p>
<ul>
<li><p>需要引入spring-boot-configuration-processor依赖</p>
</li>
<li><p>这种方法适合读取大量配置属性，</p>
</li>
<li><p>@ConfigurationProperties注解的实体类必须有get/set方法</p>
<p>新建一个实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"test"</span>, locations = <span class="string">"classpath:test.properties"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String one;</span><br><span class="line">    <span class="keyword">private</span> String two;</span><br><span class="line">    <span class="keyword">private</span> String three;</span><br><span class="line">    <span class="keyword">private</span> String four;</span><br><span class="line">    <span class="keyword">private</span> String five;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> one;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOne</span><span class="params">(String one)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.one = one;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTwo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> two;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTwo</span><span class="params">(String two)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.two = two;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getThree</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> three;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setThree</span><span class="params">(String three)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.three = three;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFour</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> four;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFour</span><span class="params">(String four)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.four = four;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> five;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFive</span><span class="params">(String five)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.five = five;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Test&#123;"</span> +</span><br><span class="line">                <span class="string">"one='"</span> + one + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", two='"</span> + two + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", three='"</span> + three + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", four='"</span> + four + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", five='"</span> + five + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置文件test.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">test.one</span>=<span class="string">one</span></span><br><span class="line"><span class="meta">test.two</span>=<span class="string">two</span></span><br><span class="line"><span class="meta">test.three</span>=<span class="string">three</span></span><br><span class="line"><span class="meta">test.four</span>=<span class="string">four</span></span><br><span class="line"><span class="meta">test.five</span>=<span class="string">five</span></span><br></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(Test<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> Test test;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> test.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>結果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Test&#123;one=<span class="string">'one'</span>, two=<span class="string">'two'</span>, three=<span class="string">'three'</span>, four=<span class="string">'four'</span>, five=<span class="string">'five'</span>&#125;</span><br></pre></td></tr></table></figure>


</li>
</ul>
</li>
</ol>
</div></article></div></div></main><footer class="footer-container"><div class="paginator"><a href="/2017/12/06/%E4%BD%BF%E7%94%A8FactoryBean%E6%9D%A5%E9%85%8D%E7%BD%AE%E7%89%B9%E5%AE%9ABean/" class="prev">PREV</a><a href="/2017/11/20/MongoDB%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" class="next">NEXT</a></div><div class="copyright"><p>© 2017 - 2019 <a href="https://www.qiudx.top">qiudx</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer></body></html>